<h2 class="section-title">Entreprises</h2>
<p class="section-desc">Gestion des entreprises textiles (CRUD, recherche et filtres).</p>

<div class="toolbar card">
  <div class="filters">
    <input type="text" [(ngModel)]="search" (ngModelChange)="load()" placeholder="Recherche (nom, email)" class="filter-input" />
    <input type="text" [(ngModel)]="pays" (ngModelChange)="load()" placeholder="Pays" class="filter-input" />
    <input type="text" [(ngModel)]="specialite" (ngModelChange)="load()" placeholder="Spécialité textile" class="filter-input" />
    <button type="button" class="btn btn-secondary" (click)="load()">Filtrer</button>
  </div>
  <button type="button" class="btn btn-secondary" (click)="exportCsv()">Export CSV</button>
  <button type="button" class="btn btn-primary" (click)="openAdd()">+ Nouvelle entreprise</button>
</div>

<p class="error-msg" *ngIf="error">{{ error }}</p>
<div *ngIf="loading" class="loading">Chargement…</div>

<div *ngIf="!loading" class="table-wrap card">
  <table>
    <thead>
      <tr>
        <th class="sortable" (click)="sortBy('nom')">Nom {{ sortColumn === 'nom' ? (sortAsc ? '↑' : '↓') : '' }}</th>
        <th class="sortable" (click)="sortBy('pays')">Pays {{ sortColumn === 'pays' ? (sortAsc ? '↑' : '↓') : '' }}</th>
        <th class="sortable" (click)="sortBy('specialiteTextile')">Spécialité {{ sortColumn === 'specialiteTextile' ? (sortAsc ? '↑' : '↓') : '' }}</th>
        <th>Email</th>
        <th>Téléphone</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let e of sortedList">
        <td>{{ e.nom }}</td>
        <td>{{ e.pays }}</td>
        <td>{{ e.specialiteTextile }}</td>
        <td>{{ e.email }}</td>
        <td>{{ e.telephone }}</td>
        <td class="actions">
          <button type="button" class="btn btn-secondary" (click)="openEdit(e)">Modifier</button>
          <button type="button" class="btn btn-danger" (click)="delete(e)">Supprimer</button>
        </td>
      </tr>
      <tr *ngIf="list.length === 0"><td colspan="6" class="empty">Aucune entreprise.</td></tr>
    </tbody>
  </table>
</div>

<!-- Modal formulaire -->
<div class="modal" *ngIf="showForm" (click)="closeForm()">
  <div class="modal-content card" (click)="$event.stopPropagation()">
    <h3>{{ editing ? 'Modifier l\'entreprise' : 'Nouvelle entreprise' }}</h3>
    <form (ngSubmit)="save()">
      <div class="form-group">
        <label>Nom *</label>
        <input [(ngModel)]="form.nom" name="nom" required />
      </div>
      <div class="form-group">
        <label>Pays</label>
        <input [(ngModel)]="form.pays" name="pays" />
      </div>
      <div class="form-group">
        <label>Spécialité textile</label>
        <input [(ngModel)]="form.specialiteTextile" name="specialiteTextile" />
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" [(ngModel)]="form.email" name="email" />
      </div>
      <div class="form-group">
        <label>Téléphone</label>
        <input [(ngModel)]="form.telephone" name="telephone" />
      </div>
      <p class="error-msg" *ngIf="error">{{ error }}</p>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeForm()">Annuler</button>
        <button type="submit" class="btn btn-primary" [disabled]="submitting">{{ submitting ? 'Enregistrement…' : 'Enregistrer' }}</button>
      </div>
    </form>
  </div>
</div>
