<h2 class="section-title">Fournisseurs</h2>
<p class="section-desc">Gestion des fournisseurs (matières premières, délais, localisation).</p>

<div class="toolbar card">
  <div class="filters">
    <input type="text" [(ngModel)]="search" (ngModelChange)="load()" placeholder="Recherche" class="filter-input" />
    <input type="text" [(ngModel)]="pays" (ngModelChange)="load()" placeholder="Pays" class="filter-input" />
    <input type="text" [(ngModel)]="ville" (ngModelChange)="load()" placeholder="Ville" class="filter-input" />
    <input type="text" [(ngModel)]="matieres" (ngModelChange)="load()" placeholder="Matières" class="filter-input" />
    <button type="button" class="btn btn-secondary" (click)="load()">Filtrer</button>
  </div>
  <button type="button" class="btn btn-secondary" (click)="exportCsv()">Export CSV</button>
  <button type="button" class="btn btn-primary" (click)="openAdd()">+ Nouveau fournisseur</button>
</div>

<p class="error-msg" *ngIf="error">{{ error }}</p>
<div *ngIf="loading" class="loading">Chargement…</div>

<div *ngIf="!loading" class="table-wrap card">
  <table>
    <thead>
      <tr>
        <th class="sortable" (click)="sortBy('nom')">Nom {{ sortColumn === 'nom' ? (sortAsc ? '↑' : '↓') : '' }}</th>
        <th class="sortable" (click)="sortBy('matieresPremieres')">Matières {{ sortColumn === 'matieresPremieres' ? (sortAsc ? '↑' : '↓') : '' }}</th>
        <th class="sortable" (click)="sortBy('delaiJours')">Délai (j) {{ sortColumn === 'delaiJours' ? (sortAsc ? '↑' : '↓') : '' }}</th>
        <th class="sortable" (click)="sortBy('ville')">Ville / Pays {{ sortColumn === 'ville' ? (sortAsc ? '↑' : '↓') : '' }}</th>
        <th>Email</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let f of sortedList">
        <td>{{ f.nom }}</td>
        <td>{{ f.matieresPremieres }}</td>
        <td>{{ f.delaiJours }}</td>
        <td>{{ f.ville }} / {{ f.pays }}</td>
        <td>{{ f.email }}</td>
        <td class="actions">
          <button type="button" class="btn btn-secondary" (click)="openEdit(f)">Modifier</button>
          <button type="button" class="btn btn-danger" (click)="delete(f)">Supprimer</button>
        </td>
      </tr>
      <tr *ngIf="list.length === 0"><td colspan="6" class="empty">Aucun fournisseur.</td></tr>
    </tbody>
  </table>
</div>

<div class="modal" *ngIf="showForm" (click)="closeForm()">
  <div class="modal-content card" (click)="$event.stopPropagation()">
    <h3>{{ editing ? 'Modifier le fournisseur' : 'Nouveau fournisseur' }}</h3>
    <form (ngSubmit)="save()">
      <div class="form-group">
        <label>Nom *</label>
        <input [(ngModel)]="form.nom" name="nom" required />
      </div>
      <div class="form-group">
        <label>Matières premières</label>
        <input [(ngModel)]="form.matieresPremieres" name="matieresPremieres" />
      </div>
      <div class="form-group">
        <label>Délai (jours)</label>
        <input type="number" [(ngModel)]="form.delaiJours" name="delaiJours" />
      </div>
      <div class="form-group">
        <label>Ville</label>
        <input [(ngModel)]="form.ville" name="ville" />
      </div>
      <div class="form-group">
        <label>Pays</label>
        <input [(ngModel)]="form.pays" name="pays" />
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" [(ngModel)]="form.email" name="email" />
      </div>
      <p class="error-msg" *ngIf="error">{{ error }}</p>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeForm()">Annuler</button>
        <button type="submit" class="btn btn-primary" [disabled]="submitting">{{ submitting ? 'Enregistrement…' : 'Enregistrer' }}</button>
      </div>
    </form>
  </div>
</div>
